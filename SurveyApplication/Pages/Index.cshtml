@page "{handler?}"
@model IndexModel
@{
	ViewData["Title"] = "Home page";
}
@using Microsoft.AspNetCore.Mvc;

@if (User.Identity.IsAuthenticated)
{


	<div class="page-header d-print-none">
		<div class="container-xl">
			<div class="row g-2 align-items-center">
				<div class="col">
					<!-- Page pre-title -->
					<div class="page-pretitle">
						Site Survey Application
					</div>
					<h2 class="page-title">
						Project Sites
					</h2>
					
				</div>
				<!-- Page title actions -->
				<div class="col-auto ms-auto d-print-none">
					<div class="btn-list">

						<a href="#" class="btn btn-primary d-sm-inline-block" data-bs-toggle="modal" data-bs-target="#modal-simple-create">
							<!-- Download SVG icon from http://tabler-icons.io/i/plus -->
							<svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></svg>
							Create New Survey
						</a>
					
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Page body -->
	<div class="page-body">
		<div class="container-xl d-flex flex-column justify-content-center">
			<div>
				
			
				
				<div class="col-12">

					<div class="card" id="table-projects">

						<div class="card-body border-bottom py-3">
							<div class="d-flex">
								<div class="text-muted">
									Search:
									<div class="ms-2 d-inline-block">
										<input type="text" class="form-control form-control-sm search" placeholder="Search Projects">
									</div>
									
								</div>

							</div>
						</div>
						<div class="table-responsive" style="min-height:30rem;">
							<table class="table card-table table-vcenter text-nowrap datatable" id="Tabla">
								<thead>
									<tr>
										<th >
											<button class="table-sort sort" data-sort="sort-project">Project ID</button>
										</th>
										<th>
											<button class="table-sort sort" data-sort="sort-customer">Customer</button>
										</th>
										<th>
											<button class="table-sort sort" data-sort="sort-pm">PM</button>
										</th>
										<th>
											<button class="table-sort sort" data-sort="sort-siteContact">Site Contact</button>

										</th>
										<th>
											<button class="table-sort sort" data-sort="sort-dateCreated">Survey Date</button>
										</th>
										<th></th>
									</tr>
								</thead>
								<tbody class="list">
									@foreach (var projSite in Model.ProjectSites)
									{


										<tr class="projects-table-row-link" id="@projSite.ProjectID">
											
											<td class="sort-project proj-column"><span class="text-reset">@projSite.ProjectID</span></td>
											<td class="sort-customer proj-column">@projSite.Customer</td>
											<td class="sort-pm proj-column">@projSite.PM_Name</td>
											<td class="sort-siteContact proj-column text-truncate">
												<div class="row align-items-center">
													<div class="col-auto">
														<span class="bg-green text-white avatar">
															<!-- Download SVG icon from http://tabler-icons.io/i/user -->
															<svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 7m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0"></path><path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"></path></svg>
														</span>
													</div>
													<div class="col">
														<div class="font-weight-medium">
															@projSite.SiteContact_Name
														</div>
														<div class="text-muted">
															@{
																if (projSite.SiteContact_Email == "" || projSite.SiteContact_Email == null)
																{
																	@projSite.SiteContact_Phone
																}
																else
																{
																	@projSite.SiteContact_Email
																}
															}
															
															
														</div>
													</div>
												</div>
											</td>

											<td class="text-nowrap text-muted sort-dateCreated proj-column" data-date="@projSite.SurveyDate">
												<!-- Download SVG icon from http://tabler-icons.io/i/calendar -->
												<svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M4 5m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path><path d="M16 3l0 4"></path><path d="M8 3l0 4"></path><path d="M4 11l16 0"></path><path d="M11 15l1 0"></path><path d="M12 15l0 3"></path></svg>
												@if (projSite.SurveyDate != null)
												{
													@projSite.SurveyDate.Value.ToShortDateString()
												}
											</td>
											<td class="text-end">
												<div class="btn-list flex-nowrap">
											
													<div class="dropdown">
														<button class="btn dropdown-toggle align-text-top project-action-btn" data-bs-toggle="dropdown">
															Actions
														</button>
														<div class="dropdown-menu dropdown-menu-end">

															<a class="dropdown-item" asp-page="./CreateSiteSurvey" asp-route-id="@projSite.ProjectID" >
																<!-- Download SVG icon from http://tabler-icons.io/i/settings -->
																<svg xmlns="http://www.w3.org/2000/svg" class="icon dropdown-item-icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"></path><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path></svg>
																Edit
															</a>
															<a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#modal-delete-survey-@projSite.Id" style="color:red;">
																<!-- Download SVG icon from http://tabler-icons.io/i/settings -->
																<svg xmlns="http://www.w3.org/2000/svg" class="icon dropdown-item-icon" style="color:red;" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
																	<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
																	<path d="M4 7l16 0"></path>
																	<path d="M10 11l0 6"></path>
																	<path d="M14 11l0 6"></path>
																	<path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path>
																	<path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path>
																</svg>																
																Delete
															</a>
														</div>
													</div>
												</div>

											</td>
										</tr>
										<div class="modal modal-blur fade" id="modal-delete-survey-@projSite.Id" tabindex="-1" role="dialog" aria-modal="true" style=" padding-left: 0px;">
											<div class="modal-dialog modal-sm modal-dialog-centered" role="document">
												<div class="modal-content">
													<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
													<div class="modal-status bg-danger"></div>
													<div class="modal-body text-center py-4">
														<svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-danger icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 9v2m0 4v.01"></path><path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75"></path></svg>
														<h3>Are you sure?</h3>
														<div class="text-muted">Are you sure you want to delete this Site @projSite.ProjectID?</div>
													</div>
													<div class="modal-footer">
														<div class="w-100">
															<div class="row">
																<div class="col">
																	<a href="#" class="btn w-100" data-bs-dismiss="modal">
																		Cancel
																	</a>
																</div>
																<div class="col">
																	<a class="btn btn-danger w-100" asp-page-handler="DeleteProjectSite" asp-route-id="@projSite.Id">
																		Delete
																	</a>

																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									}

								</tbody>
							</table>
						</div>
						<div class="card-footer d-flex align-items-center">
						<ul class="pagination" style="margin-bottom:0;">
						</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>


	<div class="modal modal-blur fade" id="modal-simple-create" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Create New Site Survey</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>

				<form method="post">
					<div class="card">
						<div class="card-body">
							<h3 class="card-title">Project ID</h3>
							<p class="card-subtitle">Please enter or search for the project ID associated with the site.</p>
							<div class="row g-2">
								<div class="col">
									<input asp-for="NewProjectSite.ProjectID" style="width:60%;" class="form-control" placeholder="Project ID" />
								</div>							
							
							
							</div>

						</div>
						<div class="card-footer d-flex">
							<div class="col">
								<button type="button" class="btn me-auto" data-bs-dismiss="modal">Close</button>
							</div>
						
						<div class="col-auto">
							<input type="submit" class="btn btn-primary ms-auto">

						</div>						
					</div>
					</div>
	
					<input type="hidden" asp-for="NewProjectSite.LastModifiedBy" value="@User.Identity.Name" />

					<input type="hidden" asp-for="NewProjectSite.CreatedBy" value="@User.Identity.Name" />
					
				</form>
			</div>
		</div>
	</div>
}

@section scripts {

	<script>
		// Sets the table rows up to open the select row's sitie survey in the editor
		var rowIds = document.getElementsByClassName("projects-table-row-link");
		for (let x = 0; x < rowIds.length; x++)
		{
			const rowId = rowIds[x];
			var trows = rowId.getElementsByClassName("proj-column");

			for (let i = 0; i < trows.length; i++) {
				const row = trows[i];

				row.addEventListener("click", () => {
					window.location.href = `/CreateSiteSurvey/` + rowId.id;

				}); 
			}
		}

		// Configures table column sorting
		var options = {
			valueNames: ['sort-project', 'sort-customer', 'sort-pm', 'sort-siteContact',
				{ attr: 'data-date', name: 'sort-dateCreated' }],
			pages: 20,
			pagination: true

		};

		var userList = new List('table-projects', options);


	</script>

}